# Burp Suite: The Basics

*Also in: Cyber Security 101 - section 8, room 4; Web Fundamentals - section 4, room 3*

## [Task 1] Introduction

In this room, we'll dive into the basics of Burp Suite, a web application security assessment framework. We'll be focusing on what it is, what tools are available within Burp, how to set up Burp Suite on your system, and how to navigate and configure it. We'll also discuss the proxy used with Burp Suite. This is more of a theoretical room, with subsequent rooms in the Burp Suite section being more hands-on.

## [Task 2] What is Burp Suite?

Burp Suite is a Java-based framework for conducting web application pentesting, and it is used for security assessments of web and mobile applications - particularly those relying on application programming interfaces (APIs).

Burp Suite lets us capture and manipulate all HTTP and HTTPS traffic sent between the browser and the server, and we can route all of these to various sections of the Burp Suite framework. The ability to do this makes Burp pretty invaluable for web app testing. There are different editions available of Burp Suite - in this room, we'll just focus on the Community Edition. There are other versions, though.

Burp Suite Professional is an unrestricted edition of Burp Suite Community, including
- Automated vulnerability scanning
- Fuzzer/brute-forcer that isn't rate limited
- The ability to save projects for future use and reporting
- Built-in APIs to allow integration with other tools
- Unrestricted ability to add new extensions
- Access to Burp Suite Collaborator, providing a unique request catcher

Burp Suite Enterprise is primarily used for continuous scanning, featuring an automated scanner that periodically checks web apps for vulnerabilities (not unlike Nessus and other vulnerability scanners). This resides on a server and constantly scans the target web apps for potential vulnerabilities.

Both Professional and Enterprise require a license. The AttackBox version and the version you can download for free on Windows are both the Community edition.

**[Task 2, Question 1] Which edition of Burp Suite runs on a server and provides constant scanning for target web apps?** - Enterprise

**[Task 2, Question 2] Burp Suite is frequently used when attacking web applications and _____ applications.** - mobile

## [Task 3] Features of Burp Community

Despite having a more limited feature set, Burp Community comes with many tools that are valuable for web testing:
- Proxy: This allows you to intercept and modify requests and responses while interacting with web apps.
- Repeater: This allows you to capture, modify, and resend the same request many times, which can be useful for sending payloads that require some trial and error (such as in SQL injection tatacks), or testing an endpoint for vulnerabilities.
- Intruder: This lets you spray endpoints with requests, commonly used in brute-forcing and fuzzing scenarios.
- Decoder: This lets you decode captured information or encode payloads before sending them off to the target. Alternative services exist, but using it within Burp can make things a little more efficient.
- Comparer: This lets you compare two pieces of data at the word or byte level. Again, this is not an exclusive feature to Burp, but it can accelerate the process.
- Sequencer: This is mainly used when evaluating the randomness of tokens, such as session cookie values and other supposedly randomly-generated data. This can be used to expose avenues for attack in algorithms with poor randomness.

Burp Suite allows you to develop extensions to enhance the framework's functionality. These can be written in Java, or with Python (via the Java Jython interpreter), or Ruby (via the Java JRuby interpreter). Burp Suite Extender lets you load extensions into the framework. The marketplace, the BApp Store, lets you download third-party modules, some of which require professional licensing while others can be used freely in Burp Community.

**[Task 3, Question 1] Which Burp Suite feature allows us to intercept requests between ourselves and the target?** - Proxy

**[Task 3, Question 2] Which Burp tool would we use to brute-force a login form?** - Intruder

## [Task 4] Installation

If using the AttackBox, you won't need to install anything. You can freely use Burp on it. Similarly, if you're on Kali Linux, it's already pre-installed. If it happens to be missing there, check Kali's apt repositories.

If you are on another system or distribution, PortSwigger gives you dedicated installers for Burp Suite Community and Professional. You choose the OS from the dropdown menu and just download from there.

Burp suite can be installed using the appropriate method on your OS. On Windows, you just run the executable. On Linux, you run the script from the terminal. If you're not using the script with `sudo`, it will install to your home directory and it will not be added to the PATH. The installation wizard is straightforward. It should be safe to accept the defaults, though you should check the installer carefully. Once installation is complete, you can just go straight into the application.

## [Task 5] The Dashboard

When you launch Burp Suite and accept the terms and conditions, you'll be prompted to select a project type. The options you have are limited in Community edition, oftentimes clicking Next to proceed with the defaults should be fine. You're also given the ability to adjust the configuration for Burp Suite; you should stick with the defaults and then click Start Burp.

Opening Burp Suite for the first time will give you a screen with training options. It's worth going through them when you can! If you don't see the training screen, you'll be presented with the Dashboard.

The Dashboard has four main components:
- Tasks: Define background tasks that Burp will do while you use the app. In Community, the default "Live Passive Crawl" task automatically logs the pages you visit; this will be good enough for us. Professional has tasks like on-demand scans.
- Event Log: Provides information about actions done by Burp Suite, e.g. starting proxy and connections.
- Issue Activity: Specific to Burp Professional, displaying vulnerabilities identified by the automated scanner, ranked by severity and filterable based on how certain the vulnerability is to exist.
- Advisory: More detailed information on identified vulnerabilities, including references and suggested remediations. May be able to put this into a report. May not show anything in Community.

Clicking the various question mark icons in Burp Suite will open a new window with helpful information; this can be valuable when you need assistance or clarification on a particular feature.

**[Task 5, Question 1] What menu provides information about the actions performed by Burp Suite, such as starting the proxy, and details about connections made through Burp?** - Event log

## [Task 6] Navigation

Navigation is primarily handled via the top menu bars, letting you switch between modules and sub-tabs within each modules. Sub-tabs will appear in a second menu bar beneath the main menu bar.
- The top row of options contains available modules in Burp Suite. You can click each module to switch between them.
- Sub-tabs: Some modules may not have this, but if one does, then you can click around the options in the second row beneath the module bar. This will often contain module-specific settings and options.
- Detaching tabs: If you'd like to view many tabs separately, you can detacth them by going to the Window option in the application menu (this is above the module selection bar), and then choose the Detach option. The selected tab opens in a separate window. You can reattach tabs through this menu too.

Default quick navigation options:
- Dashboard: CTRL + Shift + D
- Target: CTRL + Shift + T
- Proxy: CTRL + Shift + P
- Intruder: CTRL + Shift + I
- Repeater: CTRL + Shift + R

**[Task 6, Question 1] Which tab will CTRL + Shift + P switch us to?** - Proxy tab

## [Task 7] Options

Burp has two main types of settings: Global (user) settings and Project settings.
- Global settings: Affect the entire Burp installation and take effect whenever you start it. Meant to provide a baseline configuration for the Burp environment.
- Project settings: Are specific to the current project and apply only during the session. Community edition does NOT support saving projects, so these choices will effectively be lost whenever you close Burp.

The Settings button in the top navigation bar lets you open a separate settings window.

The left-hand menu will let you switch between different types of settings, including:
- Search, which allows you to look for certain settings with keywords. This lets you quickly find things to change.
- Type filters: These let you choose between the user settings and the project settings
- Category filters: These let you select settings by category.

Many tools within Burp Suite will provide shortcuts to specific categories of settings. The Proxy module has a Proxy Settings button that opens the settings window to the relevant proxy section. It can be found in its sub-tab.

**[Task 7, Question 1] In which category can you find a reference to a "Cookie jar"?** - Sessions

**[Task 7, Question 2] In which base cateogry can you find the "Updates" sub-category, which controls the Burp Suite update behavior?** - Suite

**[Task 7, Question 3] What is the name of the sub-category which allows you to change the keybindings for shortcuts in Burp Suite?** - Hotkeys

**[Task 7, Question 4] If we have uploaded Client-Side TLS certificates, can we override these on a per-project basis (yea/nay)?** - yea

## [Task 8] Introduction to the Burp Proxy

The Burp Proxy is fundamental for using Burp Suite, allowing the user to capture requests and responses between the user and the target. This can be manipulated, sent to other tools for further testing, or explicitly allowed to continue on. Some key points:
- When requests are made through Burp, they are intercepted and _held back_ from reaching the target. These requests will appear in the Proxy tab, and you can forward them/drop them/edit them/send them to other modules. Click the Intercept is On button to disable the intercept and let requests pass.
- Being able to control requests lets testers gain complete control over web traffic, making it valuable for testing web apps.
- Burp captures and logs requests made through the proxy by default, even when interception is turned off. This can be helpful for later analysis and review of prior requests.
- Burp Suite lets you capture and log WebSocket communication, which can be helpful in analyzing web apps.
- Captured requests may be viewed in the HTTP History and WebSockets History sub-tabs, which allows for retrospective analysis and sending them off to other modules as needed.
- You can change proxy-specific options in the Proxy Settings button. These provide more control over the behavior and functionality of the proxy.

Notable features in the settings include:
- The ability to intercept server responses. By default, the proxy won't do this, but you can explicitly request it on a per-request basis. You can define rules for response interception.
- Match and Replace settings allow you to use regular expressions to modify incoming and outgoing requests, letting you dynamically change things (e.g., the user agent or cookies).

## [Task 9] Connecting Through the Proxy (FoxyProxy)

At this point you will want to start up the attached VM. To use the Burp Suite Proxy, you'll want to configure the web browser to redirect traffic through Burp Suite. This can be done with Firefox's FoxyProxy extension, though you can use alternative methods on different browsers, or just use the AttackBox.

To set up FoxyProxy:
1. Download and install the FoxyProxy Basic Extension.
2. When installed, click the FoxyProxy button in the top-right gives you access to the options.
3. Click the Options button. This gives you a new browser tab for the FoxyProxy configurations. Click Add.
4. Fill in the title (this can be whatever you want), the proxy as `127.0.0.1`, and the port as `8080`.
5. Click Save to save the Burp Proxy configuration.
6. To activate the configuration, click the FoxyProxy icon and then select the configuration from the list that drops down. This redirects all traffic through `127.0.0.1:8080`; note that Burp Suite must be running for your browser to make requests.
7. In Burp Suite, ensure that the Intercept has been turned on in the Proxy tab.
8. If all goes well, try navigating to a webpage in Firefox. The browser should hang, and the proxy will display the HTTP request.

Some things to keep in mind:
- When the proxy configuration is active and the intercept is enabled, your browser will hang whenever a request is made.
- Don't leave Intercept switched on unintentionally; this can stop the browser from making any requests.
- Right-clicking on a request in Burp Suite lets you perform various actions: forwarding, dropping, sending to other tools, selecting other options...

Note that in this room, you should close other tabs in the AttackBox browser before enabling interception; you may get some WebSocket requests if you don't.

## [Task 10] Site Map and Issue Definitions

The Target Tab gives you plenty of control over how you do your testing. There are three sub-tabs:
- The Site Map tab lets you map out the web apps you're targeting in a tree structure. Every page visited while the proxy is active will be displayed on the site map; this basically gives you a free site map. In the Professional version you can automate this process, though this is still a very handy tool in Community. It's really good at mapping out API endpoints accessed by the web application.
- Issue definitions: In Community, we still have a list of all vulnerabilities that the scanner _would_ look for if we had Professional. This gives an extensive list of web vulnerabilities, including descriptions and references. This can be helpful for referencing vulnerabilities in reports and describing vulnerabilities that have cropped up in testing.
- Scope settings: This lets you control the target scope in Burp Suite, allowing you to include and exclude certain domains and IPs to define the testing scope. By managing this, you can focus on web apps that you're targeting and avoid capturing unnecessary traffic.

The challenge in this task is to visit the webpages linked to from the home page at `http://MACHINE_IP/`. When we do this and check our sitemap, we'll see a pretty unusual endpoint.

**[Task 10, Question 1] What is the flag you receive after visting the unusual endpoint?** - `THM{NmNlZTliNGE1MWU1ZTQzMzgzNmFiNWVk}`

## [Task 11] The Burp Suite Browser

Burp Suite comes with a built-in Chromium browser that is preconfigured to use the proxy without needing any of the modifications we had to do in the pervious tasks. You simply go to the Proxy -> Intercept tab and then click the Open Browser button. A Chromium window opens and any requests made through this browser go through the proxy.

Be mindful of changing settings for this browser - they're spread out across the project and user options.

If you're running Burp Suite on Linux as the root user, which will be the case on the AttackBox, the browser will not due to the inability to create a sanbox environment. The two potential solutions are
- ...to create a new user and run Burp Suite in a low-privilege account. This is the smart solution. Or...
- ...you go to Settings -> Tools -> Burp's browser -> check Allow Burp's browser to be run without a sandbox. This lets the browser start, but this is disabled by default for security reasons. Be cautious when using the browser in this way. If an attacker compromises the browser, they could get access to your entire machine.

## [Task 12] Scoping and Targeting

Capturing and logging web traffic can quickly become overwhelming and inconvenient - maybe you only want to focus on specific web applications. You can set a scope in the project so that Burp Suite only proxies and logs exactly what you want to test. You can set this up by switching to the Target tab, right-clicking the target on the list, and then selecting Add to Scope. Burp then asks us if we want to stop logging anything that's not in scope - usually we'll say Yes here.

To check the scope, go to the Target -> Scope tab. This lets you control the target scope by including or excluding specific domains and IPs. Note that none of this changes how the proxy works - it'll still intercept everything until you go to the Proxy Settings sub-tab and checking "And URL Is in target scope" from the request interception rules. This will ignore any traffic not within the defined scope, resulting in a cleaner traffic view in Burp.

## [Task 13] Proxying HTTPS

NOTE: The AttackBox has been set up to solve the problem discussed here. If you're using the AttackBox, skip ahead.

When intercepting HTTP traffic, we may run into an issue when navigating to sites with TLS enabled: the PortSwigger Certificate Authority (CA) is not authorized to secure the connection. The browser might not trust the certificate presented by Burp Suite. We can add the BurpSuite CA to our list of trusted CAs, though.

In Firefox, do the following:
1. Download the CA certificate. With the Burp Proxy activated, go to `http://burp/cert` to download the `cacert.der` file. Save it onto your machine.
2. Go to Firefox's Certificate settings. You can do this be typing `about:preferences` in the URL bar and pressing Enter. Search the page for certificates and click on the View Certificates button.
3. In the Certificate Manager window, click Import, and then select the `cacert.der` file you downloaded.
4. In the subsequent window that appears, check the box that says "Trust this CA to identify websites" - click OK.

This should add the PortSwigger CA to our list of trusted CAs, allowing us to visit any TLS-enabled site without running into issues.

## [Task 14] Example Attack

A simplified real-world example of how Burp can be used can be found in `http://MACHINE_IP/ticket/`. This is the support form. We can test this page for many things (e.g., cross-site scripting/XSS - injecting JavaScript or something similar into a web page and having it execute).

In the Contact Email field, if we type `<script>alert("Succ3ssful XSS")</script>`, we'll run into some problems. Namely, you won't be able to type special characters that aren't allowed in email addresses. Fortunately these filters are client-side.

If we have Burp Suite active and the Intercept enabled, then we can enter some legitimate data into the support form. If we submit the form, the proxy should intercept the request. Then we replace the email (everything between `email=` and the `&` symbol) with our `<script>alert("Succ3ssful XSS")</script>` thing from earlier. We can paste the payload in and press CTRL + U to encode it and make it safe to send. If we forward this request, we'll have successfully attacked the web app.

## [Task 15] Conclusion

This should be enough to give a basic overview of the basics of Burp Suite. These provide a foundation for learning about web and mobile app pentesting. The more you use Burp, the better you'll get at web app pentesting. Subsequent rooms in the Burp Suite series will focus on specific features for testing and manipulating web app requests. The next room in the Cyber Security 101 module will give a broad overview of some of the most common web app vulnerabilities.
